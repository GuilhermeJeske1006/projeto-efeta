#!/bin/bash
set -e

APP_ENV=$(grep APP_ENV .env | cut -d '=' -f2)

echo "âœ… Node version: $(node -v)"
echo "âœ… NPM version: $(npm -v)"

echo "ğŸ“¦ Composer install..."
composer --no-ansi --no-interaction --optimize-autoloader --no-progress --profile --no-cache install

echo "ğŸš€ Migrations ${APP_ENV}..."
php artisan migrate --force

echo "ğŸ§¹ Cleaning node_modules and lockfile..."
rm -rf node_modules package-lock.json

echo "ğŸ“¥ Installing NPM dependencies..."
npm install --no-audit --no-optional --no-progress

echo "ğŸ—ï¸ Building Vite..."
npm run build

echo "âœ… Deploy concluÃ­do!"
